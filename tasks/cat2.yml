---

- name: "MEDIUM | WN10-00-000005 | AUDIT | Domain-joined systems must use Windows 10 Enterprise Edition 64-bit version."
  debug:
      msg:
          - "Alert! You need to be on a 64-bit operating system when joined to a domain"
          - "This is a requirement for STIG compliance"
  when:
      - wn10_00_000005
      - ansible_architecture != "64-bit"
  tags:
      - WN10-00-000005
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00227
      - SV-220697r569187_rule
      - -220697

- name: "MEDIUM | WN10-00-000010 | AUDIT | Windows 10 domain-joined systems must have a Trusted Platform Module (TPM) enabled and ready for use."
  debug:
      msg:
          - "Aert! Please confirm TPM status is Ready for use"
  when:
      - wn10_00_000010
      - ansible_windows_domain_member
  tags:
      - WN10-00-000010
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00227
      - SV-220698r569187_rule
      - V-220698

- name: "MEDIUM | WN10-00-000015 | AUDIT | Windows 10 systems must have Unified Extensible Firmware Interface (UEFI) firmware and be configured to run in UEFI mode, not Legacy BIOS."
  debug:
      msg: "Alert! Please make sure to configure UEFI Mode, not Legacy BIOS"
  when:
      - wn10_00_000015
      - not win10stig_system_is_container
      - not win10stig_system_is_vm
  tags:
      - WN10-00-000015
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00227
      - SV-220699r569187_rule
      - V-220699

- name: "MEDIUM | WN10-00-000025 | AUDIT | Windows 10 must employ automated mechanisms to determine the state of system components with regard to flaw remediation using the following frequency: continuously, where HBSS is used; 30 days, for any additional internal network scans not covered by HBSS; and annually, for external scans by Computer Network Defense Service Provider (CNDSP)"
  debug:
      msg:
          - "Alert! Please install DoD-approved ESS software and ensure it is operating continuously"
          - "Ask site ISSM for documenation fo the ESS software installation and configuration"
  when:
      - wn10_00_000025
  tags:
      - WN10-00-000025
      - CAT2
      - CCI-001233
      - SRG-OS-000191-GPOS-00080
      - SV-220701r569187_rule
      - V-220701

- name: "MEDIUM | WN10-00-000030 | AUDIT | Windows 10 information systems must use BitLocker to encrypt all disks to protect the confidentiality and integrity of all information at rest."
  block:
      - name: "MEDIUM | WN10-00-000030 | AUDIT | Windows 10 information systems must use BitLocker to encrypt all disks to protect the confidentiality and integrity of all information at rest."
        win_shell: get-bitlockervolume -MountPoint "C:" | select ProtectionStatus | format-list
        changed_when: false
        failed_when: false
        register: wn10_00_000030_bitlocker_status

      - name: "MEDIUM | WN10-00-000030 | AUDIT | Windows 10 information systems must use BitLocker to encrypt all disks to protect the confidentiality and integrity of all information at rest."
        debug:
            msg:
                - "ALERT! BitLocker is not enabled for the C:\ drive"
                - "Please enable BitLocker for at least the OS drive to conform to STIG Standards"
        when: "'On' not in wn10_00_000030_bitlocker_status.stdout"
  when:
      - wn10_00_000030
  tags:
      - WN10-00-000030
      - CAT2
      - CCI-001199
      - CCI-002475
      - CCI-002476
      - SRG-OS-000185-GPOS-00079
      - SV-220702r569228_rule
      - V-220702

- name: "MEDIUM | WN10-00-000031 | PATCH | Windows 10 systems must use a BitLocker PIN for pre-boot authentication."
  block:
      - name: "MEDIUM | WN10-00-000031 | PATCH | Windows 10 systems must use a BitLocker PIN for pre-boot authentication. | Set Advanced Startup value"
        win_regedit:
            path: HKLM:\SOFTWARE\Policies\Microsoft\FVE
            value: UseAdvancedStartup
            state: present
            data: 1
            datatype: dword

      - name: "MEDIUM | WN10-00-000031 | PATCH | Windows 10 systems must use a BitLocker PIN for pre-boot authentication. | Set BitLocker Pin settings"
        win_regedit:
            path: HKLM:\SOFTWARE\Policies\Microsoft\FVE
            value: "{{ win10stig_bitlocker_pin_type }}"
            state: present
            data: "{{ win10stig_bitlocker_tpmpin_registry_value }}"
            datatype: dword
  when:
      - wn10_00_000031
      - wn10_00_000030
      - "'On' in wn10_00_000030_bitlocker_status.stdout"
  tags:
      - WN10-00-000031
      - CAT2
      - CCI-002476
      - CCI-002475
      - CCI-001199
      - SRG-OS-000185-GPOS-00079
      - SV-220703r569288_rule
      - V-220703

- name: "MEDIUM | WN10-00-000032 | PATCH | Windows 10 systems must use a BitLocker PIN with a minimum length of 6 digits for pre-boot authentication."
  win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\FVE
      value: MinimumPIN
      state: present
      data: "{{ win10stig_bitlocker_min_pin_length }}"
      datatype: dword
  when:
      - wn10_00_000032
  tags:
      - WN10-00-000032
      - CAT2
      - CCI-001199
      - CCI-002475
      - CCI-002476
      - SRG-OS-000185-GPOS-00079
      - SV-220704r569290_rule
      - V-220704

- name: "MEDIUM | WN10-00-000035 | AUDIT | The operating system must employ a deny-all, permit-by-exception policy to allow the execution of authorized software programs."
  debug:
      msg:
          - "Alert! Please confirm you have a deny-all policy in place that utilizes a whitelist for applications."
          - "This can be done through a utility like AppLocker to limit applications only to authorized applications"
          - "There is an AppLocker white paper from NASA that can be used as a guide"
          - "https://www.iad.gov/iad/library/ia-guidance/tech-briefs/application-whitelisting-using-microsoft-applocker.cfm"
  when:
      - wn10_00_000035
  tags:
      - WN10-00-000035
      - CAT2
      - CCI-001774
      - SRG-OS-000370-GPOS-00155
      - SV-220705r569187_rule
      - V-220705

- name: "MEDIUM | WN10-00-000055 | AUDIT | Alternate operating systems must not be permitted on the same system."
  debug:
      msg: "Alert! Please confirm that no other atlernative operating systems exist on this system"
  when:
      - wn10_00_000055
  tags:
      - WN10-00-000055
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00227
      - SV-220709r569187_rule
      - V-220709

- name: "MEDIUM | WN10-00-000060 | PATCH | Non system-created file shares on a system must limit access to groups that require it."
  block:
      - name: "MEDIUM | WN10-00-000060 | AUDIT | Non system-created file shares on a system must limit access to groups that require it. | Get Share Names"
        win_shell: Get-SmbShare | Where-Object { ($_.Name -notlike "ADMIN$") -and ($_.Name -notlike 'C$') -and ($_.Name -notlike 'IPC$') } | Select-Object -Property Name | format-table -hidetableheaders
        changed_when: false
        failed_when: false
        register: wn10_00_000060_share_names

      - name: "MEDIUM | WN10-00-000060 | AUDIT | Non system-created file shares on a system must limit access to groups that require it. | Alert Share Names"
        debug:
            msg:
                - "Alert! You have shares that non-system created. Please manually review those shares listed below to make sure appropriate permissions are applied"
                - "{{ wn10_00_000060_share_names.stdout_lines | select() | list }}"
        when: wn10_00_000060_share_names.stdout_lines | select() | length > 0
  when:
      - wn10_00_000060
  tags:
      - WN10-00-000060
      - CAT2
      - CCI-001090
      - SRG-OS-000138-GPOS-00069
      - SV-220710r569187_rule
      - V-220710

- name: "MEDIUM | WN10-00-000075 | AUDIT | Only accounts responsible for the backup operations must be members of the Backup Operators group."
  block:
      - name: "MEDIUM | WN10-00-000075 | AUDIT | Only accounts responsible for the backup operations must be members of the Backup Operators group. | Get Backup Operator users"
        win_shell: get-localgroupmember -Name "Backup Operators" | Select-Object -Property Name | Format-Table -hidetableheaders
        changed_when: false
        failed_when: false
        register: wn10_00_000075_bo_members

      - name: "MEDIUM | WN10-00-000075 | AUDIT | Only accounts responsible for the backup operations must be members of the Backup Operators group. | Display Backup Operator users"
        debug:
            msg:
                - "Alert! Below are the users in the Backup Operators group. Please review accounts are appropriate"
                - "{{ wn10_00_000075_bo_members.stdout_lines | select() | list }}"
        when: wn10_00_000075_bo_members.stdout_lines | select() | list | length > 0
  when:
      - wn10_00_000075
  tags:
      - WN10-00-000075
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00227
      - SV-220713r569187_rule
      - V-220713

- name: "MEDIUM | WN10-00-000080 | AUDIT | Only authorized user accounts must be allowed to create or run virtual machines on Windows 10 systems."
  block:
      - name: "MEDIUM | WN10-00-000080 | AUDIT | Only authorized user accounts must be allowed to create or run virtual machines on Windows 10 systems. | Get Hyper-V group users"
        win_shell: get-localgroupmember -Name "Hyper-V Administrators" | Select-Object -Property Name | Format-Table -hidetableheaders
        changed_when: false
        failed_when: false
        register: wn10_00_000080_hyperv_members

      - name: "MEDIUM | WN10-00-000080 | AUDIT | Only authorized user accounts must be allowed to create or run virtual machines on Windows 10 systems. | Display Hyper-V group users"
        debug:
            msg:
                - "Alert! Below are the users in the Hyper-V Administrators group, please remove any unnecessary accounts"
                - "{{ wn10_00_000080_hyperv_members.stdout_lines | select() | list }}"
        when: wn10_00_000080_hyperv_members | select() | list | length > 0
  when:
      - wn10_00_000080
  tags:
      - WN10-00-000080
      - CAT2
      - CCI-000381
      - SRG-OS-000095-GPOS-00049
      - SV-220714r569187_rule
      - V-220714

- name: "MEDIUM | WN10-00-000090 | PATCH | Accounts must be configured to require password expiration."
  block:
      - name: "MEDIUM | WN10-00-000090 | AUDIT | Accounts must be configured to require password expiration. | Get list of PW Never Expire users"
        win_shell: get-localuser  | select Name, Enabled, PasswordExpires | Where-Object -Property Enabled -eq True | Where { $_.PasswordExpires -eq $null } | Select-Object -Property Name | Format-Table -hidetableheaders
        changed_when: false
        failed_when: false
        register: wn10_00_000090_neverexpire_passwords

      - name: "MEDIUM | WN10-00-000090 | AUDIT | Accounts must be configured to require password expiration. | Display list of PW Never Expire users"
        debug:
            msg:
                - "Alert! You have some accounts that are set to never expire. Please review the below accounts and set an expiration"
                - "{{ wn10_00_000090_neverexpire_passwords.stdout_lines | select() | list }}"
        when:
            - wn10_00_000090_neverexpire_passwords.stdout_lines | select() | list | length > 0
            - not win10stig_disruption_high
    
      - name: "MEDIUM | WN10-00-000090 | PATCH | Accounts must be configured to require password expiration. | Set PW to Expire for PW Never Expire users"
        win_user:
            name: "{{ item }}"
            password_never_expires: false
        with_items:
            - "{{ wn10_00_000090_neverexpire_passwords.stdout_lines | select() | list }}"
        when:
            - wn10_00_000090_neverexpire_passwords.stdout_lines | select() | list | length > 0
            - win10stig_disruption_high
  when:
      - wn10_00_000090
  tags:
      - WN10-00-000090
      - CAT2
      - CCI-000199
      - SRG-OS-000076-GPOS-00044
      - SV-220716r569187_rule
      - V-220716

- name: "MEDIUM | WN10-00-000095 | AUDIT | Permissions for system files and directories must conform to minimum requirements."
  win_shell: echo true
  changed_when: false
  failed_when: false
  when:
      - wn10_00_000095
  tags:
      - WN10-00-000095
      - CAT2
      - CCI-002165
      - SRG-OS-000312-GPOS-00122
      - SV-220717r569187_rule
      - V-220717
      - notimplemented

- name: "MEDIUM | WN10-00-000105 | PATCH | Simple Network Management Protocol (SNMP) must not be installed on the system."
  block:
      - name: "MEDIUM | WN10-00-000105 | AUDIT | Simple Network Management Protocol (SNMP) must not be installed on the system. | Get SNMP State"
        win_shell: Get-WindowsCapability  -Online -Name "SNMP*" | Select-Object -Property State | Format-Table -hidetableheaders
        changed_when: false
        failed_when: false
        register: wn10_00_000105_snmp_state

      - name: "MEDIUM | WN10-00-000105 | PATCH | Simple Network Management Protocol (SNMP) must not be installed on the system. | Remove SNMP"
        win_shell: remove-WindowsCapability  -Online -Name "SNMP.Client~~~~0.0.1.0"
        notify: reboot windows
        when: "'Installed' in wn10_00_000105_snmp_state.stdout"
  when:
      - wn10_00_000105
  tags:
      - WN10-00-000105
      - CCI-000382
      - SRG-OS-000096-GPOS-00050
      - SV-220719r569187_rule
      - V-220719

- name: "MEDIUM | WN10-00-000110 | PATCH | Simple TCP/IP Services must not be installed on the system."
  win_optional_feature:
      name: SimpleTCP
      state: absent
  when:
      - wn10_00_000110
  tags:
      - WN10-00-000110
      - CAT2
      - CCI-000381
      - SRG-OS-000095-GPOS-00049
      - SV-220720r569187_rule
      - V-220720

- name: "MEDIUM | WN10-00-000115 | PATCH | The Telnet Client must not be installed on the system."
  win_optional_feature:
      name: TelnetClient
      state: absent
  when:
      - wn10_00_000115
  tags:
      - WN10-00-000115
      - CAT2
      - CCI-000382
      - SRG-OS-000096-GPOS-00050
      - SV-220721r569187_rule
      - V-220721

- name: "MEDIUM | WN10-00-000120 | PATCH | The TFTP Client must not be installed on the system."
  win_optional_feature:
      name: TFTP
      state: absent
  when:
      - wn10_00_000120
  tags:
      - WN10-00-000120
      - CAT2
      - CCI-000382
      - SRG-OS-000096-GPOS-00050
      - SV-220722r569187_rule
      - V-220722

- name: "MEDIUM | WN10-00-000130 | PATCH | Software certificate installation files must be removed from Windows 10."
  block:
      - name: "MEDIUM | WN10-00-000130 | AUDIT | Software certificate installation files must be removed from Windows 10. | Get Drive Letters"
        win_shell: Get-PSDrive | Select-Object -ExpandProperty 'Name' | Select-String -Pattern '^[a-z]$'
        changed_when: false
        register: wn10_00_000130_drive_letters

      - name: "MEDIUM | WN10-00-000130 | AUDIT | Software certificate installation files must be removed from Windows 10. | Search for files"
        win_find:
          paths: '{{ item }}:\'
          recurse: yes
          patterns: ['*.p12','*.pfx']
        register: wn10_00_000130_files
        with_items:
            - "{{ wn10_00_000130_drive_letters.stdout_lines | select() | list }}"

      - name: "MEDIUM | WN10-00-000130 | PATCH  | Software certificate installation files must be removed from Windows 10. | Remove Files"
        win_file:
          path: "{{ item.path }}"
          state: absent
        with_items:
            - "{{ wn10_00_000130_files.results[0].files }}"
        loop_control:
            label: "{{ item.path }}"
        when: win10stig_disruption_high

      - name: "MEDIUM | WN10-00-000130 | AUDIT | Software certificate installation files must be removed from Windows 10. | Alert on files if not Disruptive High"
        debug:
            msg:
                - "Alert! You have .p12 and/or .pfx files on your system"
                - "Please review and remove the following files"
                - "{{ wn10_00_000130_files.results[0].files | map(attribute='path') | list }}"
        when: not win10stig_disruption_high
  when:
      - wn10_00_000130
      - win10stig_lengthy_search
  tags:
      - WN10-00-000130
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00227
      - SV-220723r569187_rule
      - V-220723

- name: "MEDIUM | WN10-00-000135 | AUDIT | A host-based firewall must be installed and enabled on the system."
  block:
      - name: "MEDIUM | WN10-00-000135 | AUDIT | A host-based firewall must be installed and enabled on the system. | Get Defender Firewall status"
        win_shell: get-netfirewallprofile -all | Where-Object -Property Enabled -eq True | Select-Object -Property Name | Format-Table -hidetableheaders
        changed_when: false
        register: wn10_00_000135_defender_fw_status
        when:  win10stig_firewall_type == "defender"

      - block:
          - name: "MEDIUM | WN10-00-000135 | AUDIT | A host-based firewall must be installed and enabled on the system. | Warn on Defender Firewall enabled"
            debug:
                msg:
                    - "Warning! You are using defender and 1 or more profiles are enabled"
                    - "Please confirm the firewall profiles match the Firewall STIG"
                    - "{{ wn10_00_000135_defender_fw_status.stdout_lines | select() | list }}"
            when:
                - wn10_00_000135_defender_fw_status.stdout_lines | select() | list | length > 0
          
          - name: "MEDIUM | WN10-00-000135 | AUDIT | A host-based firewall must be installed and enabled on the system. | Alert! on Defender Firewall disabled"
            debug:
                msg:
                    - "ALERT! You are using Windows Defender as your filewall and it is fully disabled"
                    - "Please enable the firewall using a Firewall profile provided by STIG"
                    - "If you are not using Windows Defender as your firewall please adjust the win10stig_firewall_type variable to reflect that"
            when:
                - wn10_00_000135_defender_fw_status.stdout_lines | select() | list | length == 0
        when: win10stig_firewall_type == "defender"

      - name: "MEDIUM | WN10-00-000135 | AUDIT | A host-based firewall must be installed and enabled on the system. | Warn on 3rd party firewall"
        debug:
            msg:
                - "Warning! You are not using Windows Defender as your firewall."
                - "Please review the required profiles/settings for that firewall to confirm it alligns with STIG standards."
        when: win10stig_firewall_type != "defender"
  when:
      - wn10_00_000135
  tags:
      - WN10-00-000135
      - CAT2
      - CCI-000366
      - SV-220724r569187_rule
      - V-220724

- name: "MEDIUM | WN10-00-000140 | AUDIT | Inbound exceptions to the firewall on Windows 10 domain workstations must only allow authorized remote management hosts." 
  block:
      - name: "MEDIUM | WN10-00-000140 | AUDIT | Inbound exceptions to the firewall on Windows 10 domain workstations must only allow authorized remote management hosts. | Alert if automation managed not enabled" 
        debug:
            msg:
                - "Alert! You are using Windows Defender as your firewall on this host. Please confirm Inbound Rules only allow authorized inbound traffic"
        when:
            - win10stig_firewall_type == "defender"
            - ansible_windows_domain_member
            - not win10stig_firewall_automation_managed_inbound
      # - block:
      #     - name: "MEDIUM | WN10-00-000140 | AUDIT | Inbound exceptions to the firewall on Windows 10 domain workstations must only allow authorized remote management hosts. | Deny all"
      #       win_firewall_rule:
      #           name: deny_all
      #           group: automation_created
      #           action: block
      #           direction: in
      #           remoteip: any
      #           state: present
      #           enabled: false

      #     - name: "MEDIUM | WN10-00-000140 | AUDIT | Inbound exceptions to the firewall on Windows 10 domain workstations must only allow authorized remote management hosts. | Allow list"
      #       win_firewall_rule:
      #           name: "Allow Remote IP {{ item }}"
      #           group: automation_created
      #           action: allow
      #           direction: in
      #           remoteip: "{{ item }}"
      #           state: present
      #           enabled: false
      #       with_items:
      #           - "{{ win10stig_defender_fw_allow_list }}"
      #       loop_control:
      #           label: "{{ item }}"

      #     - name: "MEDIUM | WN10-00-000140 | AUDIT | Inbound exceptions to the firewall on Windows 10 domain workstations must only allow authorized remote management hosts. | Enable both rules"
      #       win_firewall_rule:
      #           group: automation_created
      #           enabled: true
      #   when: win10stig_firewall_automation_managed_inbound 
  when:
      - wn10_00_000140
  tags:
      - WN10-00-000140
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00227
      - SV-220725r569187_rule
      - V-220725
      - notimplemented

- name: "MEDIUM | WN10-00-000155 | PATCH | The Windows PowerShell 2.0 feature must be disabled on the system."
  win_optional_feature:
      name: MicrosoftWindowsPowerShellV2Root
      state: absent
  when:
      - wn10_00_000155
  tags:
      - WN10-00-000155
      - CAT2
      - CCI-000381
      - SRG-OS-000095-GPOS-00049
      - SV-220728r569187_rule
      - V-220728

- name: "MEDIUM | WN10-00-000160 | PATCH | The Server Message Block (SMB) v1 protocol must be disabled on the system."
  win_optional_feature:
      name: SMB1Protocol
      state: absent
  when:
      - wn10_00_000160
  tags:
      - WN10-00-000160
      - CAT2
      - CCI-000381
      - SRG-OS-000095-GPOS-00049
      - SV-220729r569187_rule
      - V-220729

- name: "MEDIUM | WN10-00-000165 | PATCH | The Server Message Block (SMB) v1 protocol must be disabled on the SMB server."
  win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters
      value: SMB1
      state: present
      data: 0
      datatype: dword
  when:
      - wn10_00_000165
  tags:
      - WN10-00-000165
      - CAT2
      - CCI-000381
      - SRG-OS-000095-GPOS-00049
      - SV-220730r569187_rule
      - V-220730

- name: "MEDIUM | WN10-00-000170 | PATCH | The Server Message Block (SMB) v1 protocol must be disabled on the SMB client."
  win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\mrxsmb10
      value: Start
      state: present
      data: 4
      datatype: dword
  notify: reboot windows
  when:
      - wn10_00_000170
  tags:
      - WN10-00-000170
      - CAT2
      - CCI-000381
      - SRG-OS-000095-GPOS-00049
      - SV-220731r569187_rule
      - V-220731

- name: "MEDIUM | WN10-00-000175 | PATCH | The Secondary Logon service must be disabled on Windows 10."
  win_service:
      name: seclogon
      state: stopped
      start_mode: disabled
  when:
      - wn10_00_000175
  tags:
      - WN10-00-000175
      - CAT2
      - CCI-000381
      - SRG-OS-000095-GPOS-00049
      - SV-220732r569187_rule
      - V-220732

- name: "MEDIUM | WN10-00-000190 | AUDIT | Orphaned security identifiers (SIDs) must be removed from user rights on Windows 10."
  debug:
      msg: "Warning! Please review the User Right listed for each of any unresolved SID to determine whether they are valid"
  when:
      - wn10_00_000190
  tags:
      - WN10-00-000190
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00227
      - SV-220733r569187_rule
      - V-220733

- name: "MEDIUM | WN10-00-000210 | PATCH | Bluetooth must be turned off unless approved by the organization."
  block:
      - name: "MEDIUM | WN10-00-000210 | PATCH | Bluetooth must be turned off unless approved by the organization. | Disable BT in the registry"
        win_regedit:
            path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\ActionCenter\QuickActions\All\SystemSettings_Device_BluetoothQuickAction
            value: Type
            state: present
            data: 1
            datatype: dword
        notify: reboot windows

      - name: "MEDIUM | WN10-00-000210 | PATCH | Bluetooth must be turned off unless approved by the organization. | Disable BT service"
        win_service:
            name: bthserv
            state: stopped
            start_mode: disabled
  when:
      - wn10_00_000210
  tags:
      - WN10-00-000210
      - CAT2
      - CCI-000381
      - SRG-OS-000095-GPOS-00049
      - SV-220734r569187_rule
      - V-220734

- name: "MEDIUM | WN10-00-000220 | PATCH | Bluetooth must be turned off when not in use."
  block:
      - name: "MEDIUM | WN10-00-000220 | PATCH | Bluetooth must be turned off when not in use. | Disable BT in the registry"
        win_regedit:
            path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\ActionCenter\QuickActions\All\SystemSettings_Device_BluetoothQuickAction
            value: Type
            state: present
            data: 1
            datatype: dword
        notify: reboot windows

      - name: "MEDIUM | WN10-00-000220 | PATCH | Bluetooth must be turned off when not in use. | Disable BT service"
        win_service:
            name: bthserv
            state: stopped
            start_mode: disabled
  when:
      - wn10_00_000220
  tags:
      - WN10-00-000220
      - CAT2
      - CCI-000381
      - SRG-OS-000095-GPOS-00049
      - SV-220735r569187_rule
      - V-220735

# - name: "MEDIUM | WN10-00-000230 | PATCH | The system must notify the user when a Bluetooth device attempts to connect."

#   when:
#       - WN10-00-000230
#   tags:
#       - WN10-00-000230
#       - CAT2
#       - CCI-000366
#       - SRG-OS-000480-GPOS-00227
#       - SV-220736r569187_rule
#       - V-220736
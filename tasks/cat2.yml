---

- name: "MEDIUM | WN10-00-000005 | AUDIT | Domain-joined systems must use Windows 10 Enterprise Edition 64-bit version."
  debug:
      msg:
          - "Alert! You need to be on a 64-bit operating system when joined to a domain"
          - "This is a requirement for STIG compliance"
  when:
      - wn10_00_000005
      - ansible_architecture != "64-bit"
  tags:
      - WN10-00-000005
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00227
      - SV-220697r569187_rule
      - -220697

- name: "MEDIUM | WN10-00-000010 | AUDIT | Windows 10 domain-joined systems must have a Trusted Platform Module (TPM) enabled and ready for use."
  debug:
      msg:
          - "Aert! Please confirm TPM status is Ready for use"
  when:
      - wn10_00_000010
      - ansible_windows_domain_member
  tags:
      - WN10-00-000010
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00227
      - SV-220698r569187_rule
      - V-220698

- name: "MEDIUM | WN10-00-000015 | AUDIT | Windows 10 systems must have Unified Extensible Firmware Interface (UEFI) firmware and be configured to run in UEFI mode, not Legacy BIOS."
  debug:
      msg: "Alert! Please make sure to configure UEFI Mode, not Legacy BIOS"
  when:
      - wn10_00_000015
      - not win10stig_system_is_container
      - not win10stig_system_is_vm
  tags:
      - WN10-00-000015
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00227
      - SV-220699r569187_rule
      - V-220699

- name: "MEDIUM | WN10-00-000025 | AUDIT | Windows 10 must employ automated mechanisms to determine the state of system components with regard to flaw remediation using the following frequency: continuously, where HBSS is used; 30 days, for any additional internal network scans not covered by HBSS; and annually, for external scans by Computer Network Defense Service Provider (CNDSP)"
  debug:
      msg:
          - "Alert! Please install DoD-approved ESS software and ensure it is operating continuously"
          - "Ask site ISSM for documenation fo the ESS software installation and configuration"
  when:
      - wn10_00_000025
  tags:
      - WN10-00-000025
      - CAT2
      - CCI-001233
      - SRG-OS-000191-GPOS-00080
      - SV-220701r569187_rule
      - V-220701

- name: "MEDIUM | WN10-00-000030 | AUDIT | Windows 10 information systems must use BitLocker to encrypt all disks to protect the confidentiality and integrity of all information at rest."
  block:
      - name: "MEDIUM | WN10-00-000030 | AUDIT | Windows 10 information systems must use BitLocker to encrypt all disks to protect the confidentiality and integrity of all information at rest."
        win_shell: get-bitlockervolume -MountPoint "C:" | select ProtectionStatus | format-list
        changed_when: false
        failed_when: false
        register: wn10_00_000030_bitlocker_status

      - name: "MEDIUM | WN10-00-000030 | AUDIT | Windows 10 information systems must use BitLocker to encrypt all disks to protect the confidentiality and integrity of all information at rest."
        debug:
            msg:
                - "ALERT! BitLocker is not enabled for the C:\ drive"
                - "Please enable BitLocker for at least the OS drive to conform to STIG Standards"
        when: "'On' not in wn10_00_000030_bitlocker_status.stdout"
  when:
      - wn10_00_000030
  tags:
      - WN10-00-000030
      - CAT2
      - CCI-001199
      - CCI-002475
      - CCI-002476
      - SRG-OS-000185-GPOS-00079
      - SV-220702r569228_rule
      - V-220702

- name: "MEDIUM | WN10-00-000031 | PATCH | Windows 10 systems must use a BitLocker PIN for pre-boot authentication."
  block:
      - name: "MEDIUM | WN10-00-000031 | PATCH | Windows 10 systems must use a BitLocker PIN for pre-boot authentication. | Set Advanced Startup value"
        win_regedit:
            path: HKLM:\SOFTWARE\Policies\Microsoft\FVE
            value: UseAdvancedStartup
            state: present
            data: 1
            datatype: dword

      - name: "MEDIUM | WN10-00-000031 | PATCH | Windows 10 systems must use a BitLocker PIN for pre-boot authentication. | Set BitLocker Pin settings"
        win_regedit:
            path: HKLM:\SOFTWARE\Policies\Microsoft\FVE
            value: "{{ win10stig_bitlocker_pin_type }}"
            state: present
            data: "{{ win10stig_bitlocker_tpmpin_registry_value }}"
            datatype: dword
  when:
      - wn10_00_000031
      - wn10_00_000030
      - "'On' in wn10_00_000030_bitlocker_status.stdout"
  tags:
      - WN10-00-000031
      - CAT2
      - CCI-002476
      - CCI-002475
      - CCI-001199
      - SRG-OS-000185-GPOS-00079
      - SV-220703r569288_rule
      - V-220703

- name: "MEDIUM | WN10-00-000032 | PATCH | Windows 10 systems must use a BitLocker PIN with a minimum length of 6 digits for pre-boot authentication."
  win_regedit:
      path: HKLM:\SOFTWARE\Policies\Microsoft\FVE
      value: MinimumPIN
      state: present
      data: "{{ win10stig_bitlocker_min_pin_length }}"
      datatype: dword
  when:
      - wn10_00_000032
  tags:
      - WN10-00-000032
      - CAT2
      - CCI-001199
      - CCI-002475
      - CCI-002476
      - SRG-OS-000185-GPOS-00079
      - SV-220704r569290_rule
      - V-220704

- name: "MEDIUM | WN10-00-000035 | AUDIT | The operating system must employ a deny-all, permit-by-exception wn10_AU_000085to allow the execution of authorized software programs."
  debug:
      msg:
          - "Alert! Please confirm you have a deny-all policy in place that utilizes a whitelist for applications."
          - "This can be done through a utility like AppLocker to limit applications only to authorized applications"
          - "There is an AppLocker white paper from NASA that can be used as a guide"
          - "https://www.iad.gov/iad/library/ia-guidance/tech-briefs/application-whitelisting-using-microsoft-applocker.cfm"
  when:
      - wn10_00_000035
  tags:
      - WN10-00-000035
      - CAT2
      - CCI-001774
      - SRG-OS-000370-GPOS-00155
      - SV-220705r569187_rule
      - V-220705

- name: "MEDIUM | WN10-00-000055 | AUDIT | Alternate operating systems must not be permitted on the same system."
  debug:
      msg: "Alert! Please confirm that no other atlernative operating systems exist on this system"
  when:
      - wn10_00_000055
  tags:
      - WN10-00-000055
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00227
      - SV-220709r569187_rule
      - V-220709

- name: "MEDIUM | WN10-00-000060 | PATCH | Non system-created file shares on a system must limit access to groups that require it."
  block:
      - name: "MEDIUM | WN10-00-000060 | AUDIT | Non system-created file shares on a system must limit access to groups that require it. | Get Share Names"
        win_shell: Get-SmbShare | Where-Object { ($_.Name -notlike "ADMIN$") -and ($_.Name -notlike 'C$') -and ($_.Name -notlike 'IPC$') } | Select-Object -Property Name | format-table -hidetableheaders
        changed_when: false
        failed_when: false
        register: wn10_00_000060_share_names

      - name: "MEDIUM | WN10-00-000060 | AUDIT | Non system-created file shares on a system must limit access to groups that require it. | Alert Share Names"
        debug:
            msg:
                - "Alert! You have shares that non-system created. Please manually review those shares listed below to make sure appropriate permissions are applied"
                - "{{ wn10_00_000060_share_names.stdout_lines | select() | list }}"
        when: wn10_00_000060_share_names.stdout_lines | select() | length > 0
  when:
      - wn10_00_000060
  tags:
      - WN10-00-000060
      - CAT2
      - CCI-001090
      - SRG-OS-000138-GPOS-00069
      - SV-220710r569187_rule
      - V-220710

- name: "MEDIUM | WN10-00-000075 | AUDIT | Only accounts responsible for the backup operations must be members of the Backup Operators group."
  block:
      - name: "MEDIUM | WN10-00-000075 | AUDIT | Only accounts responsible for the backup operations must be members of the Backup Operators group. | Get Backup Operator users"
        win_shell: get-localgroupmember -Name "Backup Operators" | Select-Object -Property Name | Format-Table -hidetableheaders
        changed_when: false
        failed_when: false
        register: wn10_00_000075_bo_members

      - name: "MEDIUM | WN10-00-000075 | AUDIT | Only accounts responsible for the backup operations must be members of the Backup Operators group. | Display Backup Operator users"
        debug:
            msg:
                - "Alert! Below are the users in the Backup Operators group. Please review accounts are appropriate"
                - "{{ wn10_00_000075_bo_members.stdout_lines | select() | list }}"
        when: wn10_00_000075_bo_members.stdout_lines | select() | list | length > 0
  when:
      - wn10_00_000075
  tags:
      - WN10-00-000075
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00227
      - SV-220713r569187_rule
      - V-220713

- name: "MEDIUM | WN10-00-000080 | AUDIT | Only authorized user accounts must be allowed to create or run virtual machines on Windows 10 systems."
  block:
      - name: "MEDIUM | WN10-00-000080 | AUDIT | Only authorized user accounts must be allowed to create or run virtual machines on Windows 10 systems. | Get Hyper-V group users"
        win_shell: get-localgroupmember -Name "Hyper-V Administrators" | Select-Object -Property Name | Format-Table -hidetableheaders
        changed_when: false
        failed_when: false
        register: wn10_00_000080_hyperv_members

      - name: "MEDIUM | WN10-00-000080 | AUDIT | Only authorized user accounts must be allowed to create or run virtual machines on Windows 10 systems. | Display Hyper-V group users"
        debug:
            msg:
                - "Alert! Below are the users in the Hyper-V Administrators group, please remove any unnecessary accounts"
                - "{{ wn10_00_000080_hyperv_members.stdout_lines | select() | list }}"
        when: wn10_00_000080_hyperv_members | select() | list | length > 0
  when:
      - wn10_00_000080
  tags:
      - WN10-00-000080
      - CAT2
      - CCI-000381
      - SRG-OS-000095-GPOS-00049
      - SV-220714r569187_rule
      - V-220714

- name: "MEDIUM | WN10-00-000090 | PATCH | Accounts must be configured to require password expiration."
  block:
      - name: "MEDIUM | WN10-00-000090 | AUDIT | Accounts must be configured to require password expiration. | Get list of PW Never Expire users"
        win_shell: get-localuser  | select Name, Enabled, PasswordExpires | Where-Object -Property Enabled -eq True | Where { $_.PasswordExpires -eq $null } | Select-Object -Property Name | Format-Table -hidetableheaders
        changed_when: false
        failed_when: false
        register: wn10_00_000090_neverexpire_passwords

      - name: "MEDIUM | WN10-00-000090 | AUDIT | Accounts must be configured to require password expiration. | Display list of PW Never Expire users"
        debug:
            msg:
                - "Alert! You have some accounts that are set to never expire. Please review the below accounts and set an expiration"
                - "{{ wn10_00_000090_neverexpire_passwords.stdout_lines | select() | list }}"
        when:
            - wn10_00_000090_neverexpire_passwords.stdout_lines | select() | list | length > 0
            - not win10stig_disruption_high
    
      - name: "MEDIUM | WN10-00-000090 | PATCH | Accounts must be configured to require password expiration. | Set PW to Expire for PW Never Expire users"
        win_user:
            name: "{{ item }}"
            password_never_expires: false
        with_items:
            - "{{ wn10_00_000090_neverexpire_passwords.stdout_lines | select() | list }}"
        when:
            - wn10_00_000090_neverexpire_passwords.stdout_lines | select() | list | length > 0
            - win10stig_disruption_high
  when:
      - wn10_00_000090
  tags:
      - WN10-00-000090
      - CAT2
      - CCI-000199
      - SRG-OS-000076-GPOS-00044
      - SV-220716r569187_rule
      - V-220716

- name: "MEDIUM | WN10-00-000095 | AUDIT | Permissions for system files and directories must conform to minimum requirements."
  win_shell: echo true
  changed_when: false
  failed_when: false
  when:
      - wn10_00_000095
  tags:
      - WN10-00-000095
      - CAT2
      - CCI-002165
      - SRG-OS-000312-GPOS-00122
      - SV-220717r569187_rule
      - V-220717
      - notimplemented

- name: "MEDIUM | WN10-00-000105 | PATCH | Simple Network Management Protocol (SNMP) must not be installed on the system."
  block:
      - name: "MEDIUM | WN10-00-000105 | AUDIT | Simple Network Management Protocol (SNMP) must not be installed on the system. | Get SNMP State"
        win_shell: Get-WindowsCapability  -Online -Name "SNMP*" | Select-Object -Property State | Format-Table -hidetableheaders
        changed_when: false
        failed_when: false
        register: wn10_00_000105_snmp_state

      - name: "MEDIUM | WN10-00-000105 | PATCH | Simple Network Management Protocol (SNMP) must not be installed on the system. | Remove SNMP"
        win_shell: remove-WindowsCapability  -Online -Name "SNMP.Client~~~~0.0.1.0"
        notify: reboot windows
        when: "'Installed' in wn10_00_000105_snmp_state.stdout"
  when:
      - wn10_00_000105
  tags:
      - WN10-00-000105
      - CCI-000382
      - SRG-OS-000096-GPOS-00050
      - SV-220719r569187_rule
      - V-220719

- name: "MEDIUM | WN10-00-000110 | PATCH | Simple TCP/IP Services must not be installed on the system."
  win_optional_feature:
      name: SimpleTCP
      state: absent
  when:
      - wn10_00_000110
  tags:
      - WN10-00-000110
      - CAT2
      - CCI-000381
      - SRG-OS-000095-GPOS-00049
      - SV-220720r569187_rule
      - V-220720

- name: "MEDIUM | WN10-00-000115 | PATCH | The Telnet Client must not be installed on the system."
  win_optional_feature:
      name: TelnetClient
      state: absent
  when:
      - wn10_00_000115
  tags:
      - WN10-00-000115
      - CAT2
      - CCI-000382
      - SRG-OS-000096-GPOS-00050
      - SV-220721r569187_rule
      - V-220721

- name: "MEDIUM | WN10-00-000120 | PATCH | The TFTP Client must not be installed on the system."
  win_optional_feature:
      name: TFTP
      state: absent
  when:
      - wn10_00_000120
  tags:
      - WN10-00-000120
      - CAT2
      - CCI-000382
      - SRG-OS-000096-GPOS-00050
      - SV-220722r569187_rule
      - V-220722

- name: "MEDIUM | WN10-00-000130 | PATCH | Software certificate installation files must be removed from Windows 10."
  block:
      - name: "MEDIUM | WN10-00-000130 | AUDIT | Software certificate installation files must be removed from Windows 10. | Get Drive Letters"
        win_shell: Get-PSDrive | Select-Object -ExpandProperty 'Name' | Select-String -Pattern '^[a-z]$'
        changed_when: false
        register: wn10_00_000130_drive_letters

      - name: "MEDIUM | WN10-00-000130 | AUDIT | Software certificate installation files must be removed from Windows 10. | Search for files"
        win_find:
          paths: '{{ item }}:\'
          recurse: yes
          patterns: ['*.p12','*.pfx']
        register: wn10_00_000130_files
        with_items:
            - "{{ wn10_00_000130_drive_letters.stdout_lines | select() | list }}"

      - name: "MEDIUM | WN10-00-000130 | PATCH  | Software certificate installation files must be removed from Windows 10. | Remove Files"
        win_file:
          path: "{{ item.path }}"
          state: absent
        with_items:
            - "{{ wn10_00_000130_files.results[0].files }}"
        loop_control:
            label: "{{ item.path }}"
        when: win10stig_disruption_high

      - name: "MEDIUM | WN10-00-000130 | AUDIT | Software certificate installation files must be removed from Windows 10. | Alert on files if not Disruptive High"
        debug:
            msg:
                - "Alert! You have .p12 and/or .pfx files on your system"
                - "Please review and remove the following files"
                - "{{ wn10_00_000130_files.results[0].files | map(attribute='path') | list }}"
        when: not win10stig_disruption_high
  when:
      - wn10_00_000130
      - win10stig_lengthy_search
  tags:
      - WN10-00-000130
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00227
      - SV-220723r569187_rule
      - V-220723

- name: "MEDIUM | WN10-00-000135 | AUDIT | A host-based firewall must be installed and enabled on the system."
  block:
      - name: "MEDIUM | WN10-00-000135 | AUDIT | A host-based firewall must be installed and enabled on the system. | Get Defender Firewall status"
        win_shell: get-netfirewallprofile -all | Where-Object -Property Enabled -eq True | Select-Object -Property Name | Format-Table -hidetableheaders
        changed_when: false
        register: wn10_00_000135_defender_fw_status
        when:  win10stig_firewall_type == "defender"

      - block:
          - name: "MEDIUM | WN10-00-000135 | AUDIT | A host-based firewall must be installed and enabled on the system. | Warn on Defender Firewall enabled"
            debug:
                msg:
                    - "Warning! You are using defender and 1 or more profiles are enabled"
                    - "Please confirm the firewall profiles match the Firewall STIG"
                    - "{{ wn10_00_000135_defender_fw_status.stdout_lines | select() | list }}"
            when:
                - wn10_00_000135_defender_fw_status.stdout_lines | select() | list | length > 0
          
          - name: "MEDIUM | WN10-00-000135 | AUDIT | A host-based firewall must be installed and enabled on the system. | Alert! on Defender Firewall disabled"
            debug:
                msg:
                    - "ALERT! You are using Windows Defender as your filewall and it is fully disabled"
                    - "Please enable the firewall using a Firewall profile provided by STIG"
                    - "If you are not using Windows Defender as your firewall please adjust the win10stig_firewall_type variable to reflect that"
            when:
                - wn10_00_000135_defender_fw_status.stdout_lines | select() | list | length == 0
        when: win10stig_firewall_type == "defender"

      - name: "MEDIUM | WN10-00-000135 | AUDIT | A host-based firewall must be installed and enabled on the system. | Warn on 3rd party firewall"
        debug:
            msg:
                - "Warning! You are not using Windows Defender as your firewall."
                - "Please review the required profiles/settings for that firewall to confirm it alligns with STIG standards."
        when: win10stig_firewall_type != "defender"
  when:
      - wn10_00_000135
  tags:
      - WN10-00-000135
      - CAT2
      - CCI-000366
      - SV-220724r569187_rule
      - V-220724

- name: "MEDIUM | WN10-00-000140 | AUDIT | Inbound exceptions to the firewall on Windows 10 domain workstations must only allow authorized remote management hosts." 
  block:
      - name: "MEDIUM | WN10-00-000140 | AUDIT | Inbound exceptions to the firewall on Windows 10 domain workstations must only allow authorized remote management hosts. | Alert if automation managed not enabled" 
        debug:
            msg:
                - "Alert! You are using Windows Defender as your firewall on this host. Please confirm Inbound Rules only allow authorized inbound traffic"
        when:
            - win10stig_firewall_type == "defender"
            - ansible_windows_domain_member
            - not win10stig_firewall_automation_managed_inbound
      # - block:
      #     - name: "MEDIUM | WN10-00-000140 | AUDIT | Inbound exceptions to the firewall on Windows 10 domain workstations must only allow authorized remote management hosts. | Deny all"
      #       win_firewall_rule:
      #           name: deny_all
      #           group: automation_created
      #           action: block
      #           direction: in
      #           remoteip: any
      #           state: present
      #           enabled: false

      #     - name: "MEDIUM | WN10-00-000140 | AUDIT | Inbound exceptions to the firewall on Windows 10 domain workstations must only allow authorized remote management hosts. | Allow list"
      #       win_firewall_rule:
      #           name: "Allow Remote IP {{ item }}"
      #           group: automation_created
      #           action: allow
      #           direction: in
      #           remoteip: "{{ item }}"
      #           state: present
      #           enabled: false
      #       with_items:
      #           - "{{ win10stig_defender_fw_allow_list }}"
      #       loop_control:
      #           label: "{{ item }}"

      #     - name: "MEDIUM | WN10-00-000140 | AUDIT | Inbound exceptions to the firewall on Windows 10 domain workstations must only allow authorized remote management hosts. | Enable both rules"
      #       win_firewall_rule:
      #           group: automation_created
      #           enabled: true
      #   when: win10stig_firewall_automation_managed_inbound 
  when:
      - wn10_00_000140
  tags:
      - WN10-00-000140
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00227
      - SV-220725r569187_rule
      - V-220725
      - notimplemented

- name: "MEDIUM | WN10-00-000155 | PATCH | The Windows PowerShell 2.0 feature must be disabled on the system."
  win_optional_feature:
      name: MicrosoftWindowsPowerShellV2Root
      state: absent
  when:
      - wn10_00_000155
  tags:
      - WN10-00-000155
      - CAT2
      - CCI-000381
      - SRG-OS-000095-GPOS-00049
      - SV-220728r569187_rule
      - V-220728

- name: "MEDIUM | WN10-00-000160 | PATCH | The Server Message Block (SMB) v1 protocol must be disabled on the system."
  win_optional_feature:
      name: SMB1Protocol
      state: absent
  when:
      - wn10_00_000160
  tags:
      - WN10-00-000160
      - CAT2
      - CCI-000381
      - SRG-OS-000095-GPOS-00049
      - SV-220729r569187_rule
      - V-220729

- name: "MEDIUM | WN10-00-000165 | PATCH | The Server Message Block (SMB) v1 protocol must be disabled on the SMB server."
  win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters
      value: SMB1
      state: present
      data: 0
      datatype: dword
  when:
      - wn10_00_000165
  tags:
      - WN10-00-000165
      - CAT2
      - CCI-000381
      - SRG-OS-000095-GPOS-00049
      - SV-220730r569187_rule
      - V-220730

- name: "MEDIUM | WN10-00-000170 | PATCH | The Server Message Block (SMB) v1 protocol must be disabled on the SMB client."
  win_regedit:
      path: HKLM:\SYSTEM\CurrentControlSet\Services\mrxsmb10
      value: Start
      state: present
      data: 4
      datatype: dword
  notify: reboot windows
  when:
      - wn10_00_000170
  tags:
      - WN10-00-000170
      - CAT2
      - CCI-000381
      - SRG-OS-000095-GPOS-00049
      - SV-220731r569187_rule
      - V-220731

# This service can't be stopped manually (through automation or manually through Services)
# You need to disable then reboot Windows for the service to be stopped
- name: "MEDIUM | WN10-00-000175 | PATCH | The Secondary Logon service must be disabled on Windows 10."
  win_service:
      name: seclogon
      start_mode: disabled
  notify: reboot windows
  when:
      - wn10_00_000175
  tags:
      - WN10-00-000175
      - CAT2
      - CCI-000381
      - SRG-OS-000095-GPOS-00049
      - SV-220732r569187_rule
      - V-220732

- name: "MEDIUM | WN10-00-000190 | AUDIT | Orphaned security identifiers (SIDs) must be removed from user rights on Windows 10."
  debug:
      msg: "Warning! Please review the User Right listed for each of any unresolved SID to determine whether they are valid"
  when:
      - wn10_00_000190
  tags:
      - WN10-00-000190
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00227
      - SV-220733r569187_rule
      - V-220733

- name: "MEDIUM | WN10-00-000210 | PATCH | Bluetooth must be turned off unless approved by the organization."
  block:
      - name: "MEDIUM | WN10-00-000210 | PATCH | Bluetooth must be turned off unless approved by the organization. | Disable BT in the registry"
        win_regedit:
            path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\ActionCenter\QuickActions\All\SystemSettings_Device_BluetoothQuickAction
            value: Type
            state: present
            data: 1
            datatype: dword
        notify: reboot windows

      - name: "MEDIUM | WN10-00-000210 | PATCH | Bluetooth must be turned off unless approved by the organization. | Disable BT service"
        win_service:
            name: bthserv
            state: stopped
            start_mode: disabled
  when:
      - wn10_00_000210
  tags:
      - WN10-00-000210
      - CAT2
      - CCI-000381
      - SRG-OS-000095-GPOS-00049
      - SV-220734r569187_rule
      - V-220734

- name: "MEDIUM | WN10-00-000220 | PATCH | Bluetooth must be turned off when not in use."
  block:
      - name: "MEDIUM | WN10-00-000220 | PATCH | Bluetooth must be turned off when not in use. | Disable BT in the registry"
        win_regedit:
            path: HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\ActionCenter\QuickActions\All\SystemSettings_Device_BluetoothQuickAction
            value: Type
            state: present
            data: 1
            datatype: dword
        notify: reboot windows

      - name: "MEDIUM | WN10-00-000220 | PATCH | Bluetooth must be turned off when not in use. | Disable BT service"
        win_service:
            name: bthserv
            state: stopped
            start_mode: disabled
  when:
      - wn10_00_000220
  tags:
      - WN10-00-000220
      - CAT2
      - CCI-000381
      - SRG-OS-000095-GPOS-00049
      - SV-220735r569187_rule
      - V-220735

- name: "MEDIUM | WN10-00-000230 | PATCH | The system must notify the user when a Bluetooth device attempts to connect."
  win_regedit:
      path: HKCU:\Software\Microsoft\BluetoothAuthenticationAgent
      value: AcceptIncomingRequests
      state: present
      data: 1
      datatype: dword
  when:
      - wn10_00_000230
  tags:
      - WN10-00-000230
      - CAT2
      - CCI-000366
      - SRG-OS-000480-GPOS-00227
      - SV-220736r569187_rule
      - V-220736

- name: "MEDIUM | WN10-00-000250 | AUDIT | Windows 10 non-persistent VM sessions should not exceed 24 hours."
  debug:
      msg: "Alert! Please investigate VDI settings to make sure they are non-persistent and do not exceed 24 hours"
  when:
      - wn10_00_000250
  tags:
      - WN10-00-000250
      - CAT2
      - CCI-001199
      - SRG-OS-000185-GPOS-00079
      - SV-220738r569187_rule
      - V-220738

# Needs to go before WN10-AC-000005 since the Lockout Duration could be disabled if the Lockout Policy is set to 0 causing the task to fail
- name: "MEDIUM | WN10-AC-000010 | PATCH | The number of allowed bad logon attempts must be configured to 3 or less."
  win_security_policy:
      section: System Access
      key: LockoutBadCount
      value: "{{ win10stig_account_settings.lockoutbadcount }}"
  when:
      - wn10_AC_000010
  tags:
      - WN10-AC-000010
      - CAT2
      - CCI-000044
      - SRG-OS-000021-GPOS-00005
      - SV-220740r569187_rule
      - V-220740

# Putting this before WN10-AC-000005 ensures the value being set conforms to the needed standard for account settings
# The Lockout Duration must be greater or equal to the Reset Account Lockout counter. 
- name: "MEDIUM | WN10-AC-000015 | PATCH | The period of time before the bad logon counter is reset must be configured to 15 minutes."
  win_security_policy:
      section: System Access
      key: ResetLockoutCount
      value: "{{ win10stig_account_settings.resetlockoutcount }}"
  when:
      - wn10_AC_000015
  tags:
      - WN10-AC-000015
      - CAT2
      - CCI-000044
      - CCI-002238
      - SRG-OS-000021-GPOS-00005
      - SV-220741r569187_rule
      - V-220741

- name: "MEDIUM | WN10-AC-000005 | PATCH | Windows 10 account lockout duration must be configured to 15 minutes or greater."
  win_security_policy:
      section: System Access
      key: LockoutDuration
      value: "{{ win10stig_account_settings.lockoutduration }}"
  when:
      - wn10_AC_000005
  tags:
      - WN10-AC-000005
      - CAT2
      - CCI-002238
      - SRG-OS-000329-GPOS-00128
      - SV-220739r569187_rule

- name: "MEDIUM | WN10-AC-000020 | PATCH | The password history must be configured to 24 passwords remembered."
  win_security_policy:
      section: System Access
      key: PasswordHistorySize
      value: "{{ win10stig_account_settings.passwordhistory }}"
  when:
      - wn10_AC_000020
  tags:
      - WN10-AC-000020
      - CAT2
      - CCI-000200
      - SRG-OS-000077-GPOS-00045
      - SV-220742r569187_rule
      - V-220742

- name: "MEDIUM | WN10-AC-000025 | PATCH | The maximum password age must be configured to 60 days or less."
  win_security_policy:
      section: System Access
      key: MaximumPasswordAge
      value: "{{ win10stig_account_settings.max_pass_age }}"
  when:
      - wn10_AC_000025
  tags:
      - WN10-AC-000025
      - CAT2
      - CCI-000199
      - SRG-OS-000076-GPOS-00044
      - SV-220743r569187_rule
      - V-220743

- name: "MEDIUM | WN10-AC-000030 | PATCH | The minimum password age must be configured to at least 1 day."
  win_security_policy:
      section: System Access
      key: MinimumPasswordAge
      value: "{{ win10stig_account_settings.min_pass_age }}"
  when:
      - wn10_AC_000030
  tags:
      - WN10-AC-000030
      - CAT2
      - CCI-000198
      - SRG-OS-000075-GPOS-00043
      - SV-220744r569187_rule
      - V-220744

- name: "MEDIUM | WN10-AC-000035 | PATCH | Passwords must, at a minimum, be 14 characters."
  win_security_policy:
      section: System Access
      key: MinimumPasswordLength
      value: "{{ win10stig_account_settings.min_pass_length }}"
  when:
      - wn10_AC_000035
  tags:
      - WN10-AC-000035
      - CAT2
      - CCI-000205
      - SRG-OS-000078-GPOS-00046
      - SV-220745r569187_rule
      - V-220745

- name: "MEDIUM | WN10-AC-000040 | PATCH | The built-in Microsoft password complexity filter must be enabled."
  win_security_policy:
      section: System Access
      key: PasswordComplexity
      value: 1
  when:
      - wn10_AC_000040
  tags:
      - WN10-AC-000040
      - CAT2
      - CCI-000192
      - CCI-000193
      - CCI-000194
      - CCI-001619
      - SRG-OS-000069-GPOS-00037
      - SV-220746r569187_rule
      - V-220746

- name: |
    "MEDIUM | WN10-AU-000005 | PATCH | The system must be configured to audit Account Logon - Credential Validation failures."
    "MEDIUM | WN10-AU-000010 | PATCH |  The system must be configured to audit Account Logon - Credential Validation successes."
  win_audit_policy_system:
      subcategory: Credential Validation
      audit_type: "{{ (wn10_AU_000005 and not wn10_AU_000010) | ternary ('failure', '') }}{{ (wn10_AU_000010 and not wn10_AU_000005) | ternary ('success', '') }}{{ (wn10_AU_000005 and wn10_AU_000010) | ternary ('success, failure', '') }}"
  when:
      - wn10_AU_000005 or
        wn10_AU_000010
  tags:
      - WN10-AU-000005
      - WN10-AU-000010
      - CAT2
      - CCI-000172
      - SRG-OS-000470-GPOS-00214
      - SV-220748r569187_rule
      - SV-220749r569187_rule
      - V-220748
      - V-220749

# - name: "MEDIUM | WN10-AU-000005 | PATCH | The system must be configured to audit Account Logon - Credential Validation failures."
#   block:
#       - name: "MEDIUM | WN10-AU-000005 | AUDIT | The system must be configured to audit Account Logon - Credential Validation failures. | Get Credential Validation status"
#         win_shell: AuditPol /get /subcategory:"Credential Validation" -r | ConvertFrom-Csv | Select-Object -expand "Inclusion Setting"
#         changed_when: false
#         failed_when: false
#         check_mode: no
#         ignore_errors: yes
#         register: wn10_au_000005_cred_validation_status

#       - name: "MEDIUM | WN10-AU-000005 | PATCH | The system must be configured to audit Account Logon - Credential Validation failures. | Set Failure to Credential Validation"
#         win_shell: AuditPol /set /subcategory:"Credential Validation" /failure:enable
#         when: "'Failure' not in wn10_au_000005_cred_validation_status.stdout"
#   when:
#       - wn10_AU_000005
#   tags:
#       - WN10-AU-000005
#       - CAT2
#       - CCI-000172
#       - SRG-OS-000470-GPOS-00214
#       - SV-220748r569187_rule
#       - V-220748

# - name: "MEDIUM | WN10-AU-000010 | PATCH |  The system must be configured to audit Account Logon - Credential Validation successes."
#   block:
#       - name: "MEDIUM | WN10-AU-000010 | AUDIT |  The system must be configured to audit Account Logon - Credential Validation successes. | Get Credential Validation status"
#         win_shell: AuditPol /get /subcategory:"Credential Validation" -r | ConvertFrom-Csv | Select-Object -expand "Inclusion Setting"
#         changed_when: false
#         failed_when: false
#         check_mode: no
#         ignore_errors: yes
#         register: wn10_au_000010_cred_validation_status

#       - name: "MEDIUM | WN10-AU-000010 | PATCH |  The system must be configured to audit Account Logon - Credential Validation successes. | Set Success to Credential Validation"
#         win_shell: AuditPol /set /subcategory:"Credential Validation" /success:enable
#         when: "'Success' not in wn10_au_000010_cred_validation_status.stdout"
#   when:
#       - wn10_AU_000010
#   tags:
#       - WN10-AU-000010
#       - CAT2
#       - CCI-000172
#       - SRG-OS-000470-GPOS-00214
#       - SV-220749r569187_rule
#       - V-220749

- name: "MEDIUM | WN10-AU-000030 | PATCH | The system must be configured to audit Account Management - Security Group Management successes."
  win_audit_policy_system:
      subcategory: Security Group Management
      audit_type: "{{ win10stig_audit_settings.security_group_mngmnt_include_failure | ternary ('success, failure', 'success' ) }}"
  when:
      - wn10_AU_000030
  tags:
      - WN10-AU-000030
      - CAT2
      - CCI-000018
      - CCI-000172
      - CCI-001403
      - CCI-001404
      - CCI-001405
      - CCI-002130
      - CCI-002234
      - SRG-OS-000004-GPOS-00004
      - SV-220750r569187_rule
      - V-220750

# - name: "MEDIUM | WN10-AU-000030 | PATCH | The system must be configured to audit Account Management - Security Group Management successes."
#   block:
#       - name: "MEDIUM | WN10-AU-000030 | AUDIT | The system must be configured to audit Account Management - Security Group Management successes. | Get Account Management status"
#         win_shell: AuditPol /get /subcategory:"Security Group Management" -r | ConvertFrom-Csv | Select-Object -expand "Inclusion Setting"
#         changed_when: false
#         failed_when: false
#         check_mode: no
#         ignore_errors: yes
#         register: wn10_au_000030_acct_mngmnt_status

#       - name: "MEDIUM | WN10-AU-000030 | AUDIT | The system must be configured to audit Account Management - Security Group Management successes. | Set Success to Account Management"
#         win_shell: AuditPol /set /subcategory:"Security Group Management" /success:enable
#         when: "'Success' not in wn10_au_000030_acct_mngmnt_status.stdout"
#   when:
#       - wn10_AU_000030
#   tags:
#       - WN10-AU-000030
#       - CAT2
#       - CCI-000018
#       - CCI-000172
#       - CCI-001403
#       - CCI-001404
#       - CCI-001405
#       - CCI-002130
#       - CCI-002234
#       - SRG-OS-000004-GPOS-00004
#       - SV-220750r569187_rule
#       - V-220750

- name: |
    "MEDIUM | WN10-AU-000035 | PATCH | The system must be configured to audit Account Management - User Account Management failures."
    "MEDIUM | WN10-AU-000040 | PATCH | The system must be configured to audit Account Management - User Account Management successes."
  win_audit_policy_system:
      subcategory: Credential Validation
      audit_type: "{{ (wn10_AU_000035 and not wn10_AU_000040) | ternary ('failure', '') }}{{ (wn10_AU_000040 and not wn10_AU_000035) | ternary ('success', '') }}{{ (wn10_AU_000035 and wn10_AU_000040) | ternary ('success, failure', '') }}"
  when:
      - wn10_AU_000035 or
        wn10_AU_000040
  tags:
      - WN10-AU-000035
      - WN10-AU-000040
      - CAT2
      - CCI-000018
      - CCI-000172
      - CCI-001403
      - CCI-001404
      - CCI-001405
      - CCI-002130
      - CCI-002234
      - SRG-OS-000004-GPOS-00004
      - SV-220751r569187_rule
      - SV-220752r569187_rule
      - V-220751
      - V-220752

# - name: "MEDIUM | WN10-AU-000035 | PATCH | The system must be configured to audit Account Management - User Account Management failures."
#   block:
#       - name: "MEDIUM | WN10-AU-000035 | AUDIT | The system must be configured to audit Account Management - User Account Management failures. | Get Account Management status"
#         win_shell: AuditPol /get /subcategory:"User Account Management" -r | ConvertFrom-Csv | Select-Object -expand "Inclusion Setting"
#         changed_when: false
#         failed_when: false
#         check_mode: no
#         ignore_errors: yes
#         register: wn10_au_000035_acct_mngmnt_status

#       - name: "MEDIUM | WN10-AU-000035 | PATCH | The system must be configured to audit Account Management - User Account Management failures. | Set Failure to Account Management"
#         win_shell: AuditPol /set /subcategory:"User Account Management" /failure:enable
#         when: "'Failure' not in wn10_au_000035_acct_mngmnt_status.stdout"
#   when:
#       - wn10_AU_000035
#   tags:
#       - WN10-AU-000035
#       - CAT2
#       - CCI-000018
#       - CCI-000172
#       - CCI-001403
#       - CCI-001404
#       - CCI-001405
#       - CCI-002130
#       - CCI-002234
#       - SRG-OS-000004-GPOS-00004
#       - SV-220751r569187_rule
#       - V-220751

# - name: "MEDIUM | WN10-AU-000040 | PATCH | The system must be configured to audit Account Management - User Account Management successes."
#   block:
#       - name: "MEDIUM | WN10-AU-000040 | AUDIT | The system must be configured to audit Account Management - User Account Management successes. | Get User Account Management status"
#         win_shell: AuditPol /get /subcategory:"User Account Management" -r | ConvertFrom-Csv | Select-Object -expand "Inclusion Setting"
#         changed_when: false
#         failed_when: false
#         check_mode: no
#         ignore_errors: yes
#         register: wn10_au_000040_user_acct_mngmnt_status

#       - name: "MEDIUM | WN10-AU-000040 | PATCH | The system must be configured to audit Account Management - User Account Management successes. | Set Successes to User Account Management"
#         win_shell: AuditPol /set /subcategory:"User Account Management" /success:enable
#         when: "'Success' not in wn10_au_000040_user_acct_mngmnt_status.stdout"
#   when:
#       - wn10_AU_000040
#   tags:
#       - WN10-AU-000040
#       - CAT2
#       - CCI-000018
#       - CCI-000172
#       - CCI-001403
#       - CCI-001404
#       - CCI-001405
#       - CCI-002130
#       - CCI-002234
#       - SRG-OS-000004-GPOS-00004
#       - SV-220752r569187_rule
#       - V-220752

- name: "MEDIUM | WN10-AU-000045 | PATCH | The system must be configured to audit Detailed Tracking - PNP Activity successes."
  win_audit_policy_system:
      subcategory: Plug and Play Events
      audit_type: "{{ win10stig_audit_settings.pnp_activity_include_failure | ternary ('success, failure', 'success' ) }}"
  when:
      - wn10_AU_000045
  tags:
      - WN10-AU-000045
      - CAT2
      - CCI-001814
      - CCI-000172
      - SRG-OS-000365-GPOS-00152
      - SV-220753r569187_rule
      - V-220753

# - name: "MEDIUM | WN10-AU-000045 | PATCH | The system must be configured to audit Detailed Tracking - PNP Activity successes."
#   block:
#       - name: "MEDIUM | WN10-AU-000045 | AUDIT | The system must be configured to audit Detailed Tracking - PNP Activity successes. | Get PNP Activity status"
#         win_shell: AuditPol /get /subcategory:"Plug and Play Events" -r | ConvertFrom-Csv | Select-Object -expand "Inclusion Setting"
#         changed_when: false
#         failed_when: false
#         check_mode: no
#         ignore_errors: yes
#         register: wn10_au_000045_pnp_actvity_status

#       - name: "MEDIUM | WN10-AU-000045 | PATCH | The system must be configured to audit Detailed Tracking - PNP Activity successes. | Set Successes to PNP Activity"
#         win_shell: AuditPol /set /subcategory:"Plug and Play Events" /success:enable
#         when: "'Success' not in wn10_au_000045_pnp_actvity_status.stdout"
#   when:
#       - wn10_AU_000045
#   tags:
#       - WN10-AU-000045
#       - CAT2
#       - CCI-001814
#       - CCI-000172
#       - SRG-OS-000365-GPOS-00152
#       - SV-220753r569187_rule
#       - V-220753

- name: "MEDIUM | WN10-AU-000050 | PATCH | The system must be configured to audit Detailed Tracking - Process Creation successes."
  win_audit_policy_system:
      subcategory: Process Creation
      audit_type: "{{ win10stig_audit_settings.process_creation_include_failure | ternary ('success, failure', 'success' ) }}"
  when:
      - wn10_AU_000050
  tags:
      - WN10-AU-000050
      - CAT2
      - CCI-001814
      - CCI-000172
      - SRG-OS-000365-GPOS-00152
      - SV-220754r569187_rule
      - V-220754

# - name: "MEDIUM | WN10-AU-000050 | PATCH | The system must be configured to audit Detailed Tracking - Process Creation successes."
#   block:
#       - name: "MEDIUM | WN10-AU-000050 | AUDIT | The system must be configured to audit Detailed Tracking - Process Creation successes. | Get Detailed Tracking status"
#         win_shell: AuditPol /get /subcategory:"Process Creation" -r | ConvertFrom-Csv | Select-Object -expand "Inclusion Setting"
#         changed_when: false
#         failed_when: false
#         check_mode: no
#         ignore_errors: yes
#         register: wn10_au_000050_process_creation_status

#       - name: "MEDIUM | WN10-AU-000050 | PATCH | The system must be configured to audit Detailed Tracking - Process Creation successes. | Set Successes to Detailed Tracking"
#         win_shell: AuditPol /set /subcategory:"Process Creation" /success:enable
#         when: "'Success' not in wn10_au_000050_process_creation_status.stdout"
#   when:
#       - wn10_AU_000050
#   tags:
#       - WN10-AU-000050
#       - CAT2
#       - CCI-001814
#       - CCI-000172
#       - SRG-OS-000365-GPOS-00152
#       - SV-220754r569187_rule
#       - V-220754

- name: "MEDIUM | WN10-AU-000054 | PATCH | The system must be configured to audit Logon/Logoff - Account Lockout failures."
  win_audit_policy_system:
      subcategory: Account Lockout
      audit_type: "{{ win10stig_audit_settings.accnt_lockout_include_success | ternary ('success, failure', 'failure' ) }}"
  when:
      - wn10_AU_000054
  tags:
      - WN10-AU-000054
      - CAT2
      - CCI-000172
      - SRG-OS-000470-GPOS-00214
      - SV-220755r569187_rule
      - V-220755

# - name: "MEDIUM | WN10-AU-000054 | PATCH | The system must be configured to audit Logon/Logoff - Account Lockout failures."
#   block:
#       - name: "MEDIUM | WN10-AU-000054 | AUDIT | The system must be configured to audit Logon/Logoff - Account Lockout failures. | Get Logon/Logoff status"
#         win_shell: AuditPol /get /subcategory:"Account Lockout" -r | ConvertFrom-Csv | Select-Object -expand "Inclusion Setting"
#         changed_when: false
#         failed_when: false
#         check_mode: no
#         ignore_errors: yes
#         register: wn10_au_000054_account_lockout_failure_status

#       - name: "MEDIUM | WN10-AU-000054 | PATCH | The system must be configured to audit Logon/Logoff - Account Lockout failures. | Set failure to  Logon/Logoff"
#         win_shell: AuditPol /set /subcategory:"Account Lockout" /failure:enable
#         when: "'Failure' not in wn10_au_000054_account_lockout_failure_status.stdout"
#   when:
#       - wn10_AU_000054
#   tags:
#       - WN10-AU-000054
#       - CAT2
#       - CCI-000172
#       - SRG-OS-000470-GPOS-00214
#       - SV-220755r569187_rule
#       - V-220755

- name: "MEDIUM | WN10-AU-000060 | PATCH | The system must be configured to audit Logon/Logoff - Group Membership successes."
  win_audit_policy_system:
      subcategory: Group Membership
      audit_type: "{{ win10stig_audit_settings.group_membership_include_failure | ternary ('success, failure', 'success' ) }}"
  when:
      - wn10_AU_000060
  tags:
      - WN10-AU-000060
      - CAT2
      - CCI-000172
      - SRG-OS-000470-GPOS-00214
      - SV-220756r569187_rule
      - V-220756

# - name: "MEDIUM | WN10-AU-000060 | PATCH | The system must be configured to audit Logon/Logoff - Group Membership successes."
#   block:
#       - name: "MEDIUM | WN10-AU-000060 | AUDIT | The system must be configured to audit Logon/Logoff - Group Membership successes. | Get Group Membership status"
#         win_shell: AuditPol /get /subcategory:"Group Membership" -r | ConvertFrom-Csv | Select-Object -expand "Inclusion Setting"
#         changed_when: false
#         failed_when: false
#         check_mode: no
#         ignore_errors: yes
#         register: wn10_au_000060_group_membership_status

#       - name: "MEDIUM | WN10-AU-000060 | PATCH | The system must be configured to audit Logon/Logoff - Group Membership successes. | Set Success to Group Membership"
#         win_shell: AuditPol /set /subcategory:"Group Membership" /success:enable
#         when: "'Success' not in wn10_au_000060_group_membership_status.stdout"
#   when:
#       - wn10_AU_000060
#   tags:
#       - WN10-AU-000060
#       - CAT2
#       - CCI-000172
#       - SRG-OS-000470-GPOS-00214
#       - SV-220756r569187_rule
#       - V-220756

- name: "MEDIUM | WN10-AU-000065 | PATCH | The system must be configured to audit Logon/Logoff - Logoff successes."
  win_audit_policy_system:
      subcategory: Logoff
      audit_type: "{{ win10stig_audit_settings.logoff_include_failure | ternary ('success, failure', 'success' ) }}"
  when:
      - wn10_AU_000065
  tags:
      - WN10-AU-000065
      - CAT2
      - CCI-000067
      - CCI-000172
      - SRG-OS-000032-GPOS-00013
      - SV-220757r569187_rule
      - V-220757

# - name: "MEDIUM | WN10-AU-000065 | PATCH | The system must be configured to audit Logon/Logoff - Logoff successes."
#   block:
#       - name: "MEDIUM | WN10-AU-000065 | AUDIT | The system must be configured to audit Logon/Logoff - Logoff successes. | Get Logff status"
#         win_shell: AuditPol /get /subcategory:"Logoff" -r | ConvertFrom-Csv | Select-Object -expand "Inclusion Setting"
#         changed_when: false
#         failed_when: false
#         check_mode: no
#         ignore_errors: yes
#         register: wn10_au_000065_logoff_status

#       - name: "MEDIUM | WN10-AU-000065 | PATCH | The system must be configured to audit Logon/Logoff - Logoff successes. | Set Sucess to Logff"
#         win_shell: AuditPol /set /subcategory:"Logoff" /success:enable
#         when: "'Success' not in wn10_au_000065_logoff_status.stdout"
#   when:
#       - wn10_AU_000065
#   tags:
#       - WN10-AU-000065
#       - CAT2
#       - CCI-000067
#       - CCI-000172
#       - SRG-OS-000032-GPOS-00013
#       - SV-220757r569187_rule
#       - V-220757

- name: |
    "MEDIUM | WN10-AU-000070 | PATCH | The system must be configured to audit Logon/Logoff - Logon failures."
    "MEDIUM | WN10-AU-000075 | PATCH | The system must be configured to audit Logon/Logoff - Logon successes."
  win_audit_policy_system:
      subcategory: Logon
      audit_type: "{{ (wn10_AU_000070 and not wn10_AU_000075) | ternary ('failure', '') }}{{ (wn10_AU_000075 and not wn10_AU_000070) | ternary ('success', '') }}{{ (wn10_AU_000070 and wn10_AU_000075) | ternary ('success, failure', '') }}"
  when:
      - wn10_AU_000070 or
        wn10_AU_000075
  tags:
      - WN10-AU-000070
      - WN10-AU-000075
      - CAT2
      - CCI-000067
      - CCI-000172
      - SRG-OS-000032-GPOS-00013
      - SV-220758r569187_rule
      - SV-220759r569187_rule
      - V-220758
      - V-220759


# - name: "MEDIUM | WN10-AU-000070 | PATCH | The system must be configured to audit Logon/Logoff - Logon failures."
#   block:
#       - name: "MEDIUM | WN10-AU-000070 | AUDIT | The system must be configured to audit Logon/Logoff - Logon failures. | Get Logon status"
#         win_shell: AuditPol /get /subcategory:"Logon" -r | ConvertFrom-Csv | Select-Object -expand "Inclusion Setting"
#         changed_when: false
#         failed_when: false
#         check_mode: no
#         ignore_errors: yes
#         register: wn10_au_000070_logon_status

#       - name: "MEDIUM | WN10-AU-000070 | PATCH | The system must be configured to audit Logon/Logoff - Logon failures. | Set failure to Logon"
#         win_shell: AuditPol /set /subcategory:"Logon" /failure:enable
#         when: "'Failure' not in wn10_au_000070_logon_status.stdout"
#   when:
#       - wn10_AU_000070
#   tags:
#       - WN10-AU-000070
#       - CAT2
#       - CCI-000067
#       - CCI-000172
#       - SRG-OS-000032-GPOS-00013
#       - SV-220758r569187_rule
#       - V-220758

# - name: "MEDIUM | WN10-AU-000075 | PATCH | The system must be configured to audit Logon/Logoff - Logon successes."
#   block:
#       - name: "MEDIUM | WN10-AU-000075 | AUDIT | The system must be configured to audit Logon/Logoff - Logon successes. | Get logon status"
#         win_shell: AuditPol /get /subcategory:"Logon" -r | ConvertFrom-Csv | Select-Object -expand "Inclusion Setting"
#         changed_when: false
#         failed_when: false
#         check_mode: no
#         ignore_errors: yes
#         register: wn10_au_000075_logon_status

#       - name: "MEDIUM | WN10-AU-000075 | PATCH | The system must be configured to audit Logon/Logoff - Logon successes. | Set success to logon"
#         win_shell: AuditPol /set /subcategory:"Logon" /success:enable
#         when: "'Success' not in wn10_au_000075_logon_status.stdout"
#   when:
#       - wn10_AU_000075
#   tags:
#       - WN10-AU-000075
#       - CAT2
#       - CCI-000067
#       - CCI-000172
#       - SRG-OS-000032-GPOS-00013
#       - SV-220759r569187_rule
#       - V-220759

- name: "MEDIUM | WN10-AU-000080 | PATCH | The system must be configured to audit Logon/Logoff - Special Logon successes."
  win_audit_policy_system:
      subcategory: Special Logon
      audit_type: "{{ win10stig_audit_settings.special_logon_include_failure | ternary ('success, failure', 'success' ) }}"
  when:
      - wn10_AU_000080
  tags:
      - WN10-AU-000080
      - CAT2
      - CCI-000172
      - SRG-OS-000470-GPOS-00214
      - SV-220760r569187_rule
      - V-220760

# - name: "MEDIUM | WN10-AU-000080 | PATCH | The system must be configured to audit Logon/Logoff - Special Logon successes."
#   block:
#       - name: "MEDIUM | WN10-AU-000080 | AUDIT | The system must be configured to audit Logon/Logoff - Special Logon successes. | Get Special Logon status"
#         win_shell: AuditPol /get /subcategory:"Special Logon" -r | ConvertFrom-Csv | Select-Object -expand "Inclusion Setting"
#         changed_when: false
#         failed_when: false
#         check_mode: no
#         ignore_errors: yes
#         register: wn10_au_000080_special_logon_status

#       - name: "MEDIUM | WN10-AU-000080 | PATCH | The system must be configured to audit Logon/Logoff - Special Logon successes. | Set success to Special Logon"
#         win_shell: AuditPol /set /subcategory:"Special Logon" /success:enable
#         when: "'Success' not in wn10_au_000080_special_logon_status.stdout"
#   when:
#       - wn10_AU_000080
#   tags:
#       - WN10-AU-000080
#       - CAT2
#       - CCI-000172
#       - SRG-OS-000470-GPOS-00214
#       - SV-220760r569187_rule
#       - V-220760

- name: |
    "MEDIUM | WN10-AU-000081 | PATCH | Windows 10 must be configured to audit Object Access - File Share failures."
    "MEDIUM | WN10-AU-000082 | PATCH | Windows 10 must be configured to audit Object Access - File Share successes."
  win_audit_policy_system:
      subcategory: File Share
      audit_type: "{{ (wn10_AU_000081 and not wn10_AU_000082) | ternary ('failure', '') }}{{ (wn10_AU_000082 and not wn10_AU_000081) | ternary ('success', '') }}{{ (wn10_AU_000081 and wn10_AU_000082) | ternary ('success, failure', '') }}"
  when:
      - wn10_AU_000081 or
        wn10_AU_000082
  tags:
      - WN10-AU-000081
      - WN10-AU-000082
      - CAT2
      - CCI-000172
      - SRG-OS-000474-GPOS-00219
      - SV-220761r569187_rule
      - SV-220762r569187_rule
      - V-220761
      - V-220762

# - name: "MEDIUM | WN10-AU-000081 | PATCH | Windows 10 must be configured to audit Object Access - File Share failures."
#   block:
#       - name: "MEDIUM | WN10-AU-000081 | AUDIT | Windows 10 must be configured to audit Object Access - File Share failures. | Get File Share status"
#         win_shell: AuditPol /get /subcategory:"File Share" -r | ConvertFrom-Csv | Select-Object -expand "Inclusion Setting"
#         changed_when: false
#         failed_when: false
#         check_mode: no
#         ignore_errors: yes
#         register: wn10_au_000081_file_share_status

#       - name: "MEDIUM | WN10-AU-000081 | PATCH | Windows 10 must be configured to audit Object Access - File Share failures. | Set failure to File Share"
#         win_shell: AuditPol /set /subcategory:"File Share" /failure:enable
#         when: "'Failure' not in wn10_au_000081_file_share_status.stdout"
#   when:
#       - wn10_AU_000081
#   tags:
#       - WN10-AU-000081
#       - CAT2
#       - CCI-000172
#       - SRG-OS-000474-GPOS-00219
#       - SV-220761r569187_rule
#       - V-220761

# - name: "MEDIUM | WN10-AU-000082 | PATCH | Windows 10 must be configured to audit Object Access - File Share successes."
#   block:
#       - name: "MEDIUM | WN10-AU-000082 | AUDIT | Windows 10 must be configured to audit Object Access - File Share successes. | Get File Share status"
#         win_shell: AuditPol /get /subcategory:"File Share" -r | ConvertFrom-Csv | Select-Object -expand "Inclusion Setting"
#         changed_when: false
#         failed_when: false
#         check_mode: no
#         ignore_errors: yes
#         register: wn10_au_000082_file_share_status

#       - name: "MEDIUM | WN10-AU-000082 | PATCH | Windows 10 must be configured to audit Object Access - File Share successes. | Set success to File Share"
#         win_shell: AuditPol /set /subcategory:"File Share" /success:enable
#         when: "'Success' not in wn10_au_000082_file_share_status.stdout"
#   when:
#       - wn10_AU_000082
#   tags:
#       - WN10-AU-000082
#       - CAT2
#       - CCI-000172
#       - SRG-OS-000474-GPOS-00219
#       - SV-220762r569187_rule
#       - V-220762

- name: |
    "MEDIUM | WN10-AU-000083 | PATCH | Windows 10 must be configured to audit Object Access - Other Object Access Events successes."
    "MEDIUM | WN10-AU-000084 | PATCH | Windows 10 must be configured to audit Object Access - Other Object Access Events failures."
  win_audit_policy_system:
      subcategory: Other Object Access Events
      audit_type: "{{ (wn10_AU_000083 and not wn10_AU_000084) | ternary ('success', '') }}{{ (wn10_AU_000084 and not wn10_AU_000083) | ternary ('failure', '') }}{{ (wn10_AU_000083 and wn10_AU_000084) | ternary ('success, failure', '') }}"
  when:
      - wn10_AU_000083 or
        wn10_AU_000084
  tags:
      - WN10-AU-000083
      - WN10-AU-000084
      - CAT2
      - CCI-000172
      - SRG-OS-000474-GPOS-00219
      - SV-220763r569187_rule
      - SV-220764r569187_rule
      - V-220763
      - V-220764

- name: |
    "MEDIUM | WN10-AU-000085 | PATCH | The system must be configured to audit Object Access - Removable Storage failures."
    "MEDIUM | WN10-AU-000090 | PATCH | The system must be configured to audit Object Access - Removable Storage successes."
  win_audit_policy_system:
      subcategory: Removable Storage
      audit_type: "{{ (wn10_AU_000085 and not wn10_AU_000090) | ternary ('failure', '') }}{{ (wn10_AU_000090 and not wn10_AU_000085) | ternary ('success', '') }}{{ (wn10_AU_000085 and wn10_AU_000090) | ternary ('success, failure', '') }}"
  when:
      - wn10_AU_000085 or
        wn10_AU_000090

  tags:
      - WN10-AU-000085
      - WN10-AU-000090
      - CAT2
      - CCI-000172
      - SRG-OS-000474-GPOS-00219
      - SV-220765r569187_rule
      - SV-220766r569187_rule
      - V-220765
      - V-220766

- name: "MEDIUM | WN10-AU-000100 | PATCH | The system must be configured to audit Policy Change - Audit Policy Change successes."
  win_audit_policy_system:
      subcategory: Audit Policy Change
      audit_type: "{{ win10stig_audit_settings.audit_policy_change_include_failure | ternary ('success, failure', 'success' ) }}"
  when:
      - wn10_AU_000100
  tags:
      - WN10-AU-000100
      - CAT2
      - CCI-000172
      - SRG-OS-000471-GPOS-00215
      - SV-220767r569187_rule
      - V-220767

- name: "MEDIUM | WN10-AU-000105 | PATCH | The system must be configured to audit Policy Change - Authentication Policy Change successes."
  win_audit_policy_system:
      subcategory: Authentication Policy Change
      audit_type: "{{ win10stig_audit_settings.authentication_policy_change_include_failure | ternary ('success, failure', 'success' ) }}"
  when:
      - wn10_AU_000105
  tags:
      - WN10-AU-000105
      - CAT2
      - CCI-002234
      - CCI-000172
      - SRG-OS-000327-GPOS-00127
      - SV-220768r569187_rule
      - V-220768

- name: "MEDIUM | WN10-AU-000107 | PATCH | The system must be configured to audit Policy Change - Authorization Policy Change successes."
  win_audit_policy_system:
      subcategory: Authorization Policy Change
      audit_type: "{{ win10stig_audit_settings.authorization_policy_change_include_failure | ternary ('success, failure', 'success' ) }}"
  when:
      - wn10_AU_000107
  tags:
      - WN10-AU-000107
      - CAT2
      - CCI-000172
      - SRG-OS-000471-GPOS-00215
      - SV-220769r569187_rule
      - V-220769

- name: |
    "MEDIUM | WN10-AU-000110 | PATCH | The system must be configured to audit Privilege Use - Sensitive Privilege Use failures."
    "MEDIUM | WN10-AU-000115 | PATCH | The system must be configured to audit Privilege Use - Sensitive Privilege Use successes."
  win_audit_policy_system:
      subcategory: Sensitive Privilege Use
      audit_type: "{{ (wn10_AU_000110 and not wn10_AU_000115) | ternary ('failure', '') }}{{ (wn10_AU_000115 and not wn10_AU_000110) | ternary ('success', '') }}{{ (wn10_AU_000110 and wn10_AU_000115) | ternary ('success, failure', '') }}"
  when:
      - wn10_AU_000110 or
        wn10_AU_000115
  tags:
      - WN10-AU-000110
      - WN10-AU-000115
      - CAT2
      - CCI-002234
      - CCI-000172
      - SRG-OS-000327-GPOS-00127
      - SV-220770r569187_rule
      - SV-220771r569187_rule
      - V-220770
      - V-220771

- name: "MEDIUM | WN10-AU-000120 | PATCH | The system must be configured to audit System - IPSec Driver failures."
  win_audit_policy_system:
      subcategory: IPSec Driver
      audit_type: "{{ win10stig_audit_settings.ipsec_drive_include_success | ternary ('success, failure', 'failure' ) }}"
  when:
      - wn10_AU_000120
  tags:
      - WN10-AU-000120
      - CAT2
      - CCI-000172
      - SRG-OS-000477-GPOS-00222
      - SV-220772r569187_rule
      - V-220772

- name: |
    "MEDIUM | WN10-AU-000130 | PATCH | The system must be configured to audit System - Other System Events successes."
    "MEDIUM | WN10-AU-000135 | PATCH | The system must be configured to audit System - Other System Events failures."
  win_audit_policy_system:
      subcategory: Other System Events
      audit_type: "{{ (wn10_AU_000130 and not wn10_AU_000135) | ternary ('success', '') }}{{ (wn10_AU_000135 and not wn10_AU_000130) | ternary ('failure', '') }}{{ (wn10_AU_000130 and wn10_AU_000135) | ternary ('success, failure', '') }}"
  when:
      - wn10_AU_000130 or
        wn10_AU_000135
  tags:
      - WN10-AU-000130
      - WN10-AU-000135
      - CAT2
      - CCI-000172
      - SRG-OS-000471-GPOS-00215
      - SV-220773r569187_rule
      - SV-220774r569187_rule
      - V-220773
      - V-220774

- name: "MEDIUM | WN10-AU-000140 | PATCH | The system must be configured to audit System - Security State Change successes."
  win_audit_policy_system:
      subcategory: Security State Change
      audit_type: "{{ win10stig_audit_settings.security_state_change_include_failure | ternary ('success, failure', 'success' ) }}"
  when:
      - wn10_AU_000140
  tags:
      - WN10-AU-000140
      - CAT2
      - CCI-002234
      - CCI-000172
      - SRG-OS-000327-GPOS-00127
      - SV-220775r569187_rule
      - V-220775

- name: "MEDIUM | WN10-AU-000150 | PATCH | The system must be configured to audit System - Security System Extension successes."
  win_audit_policy_system:
      subcategory: Security System Extension
      audit_type: "{{ win10stig_audit_settings.security_system_extension_include_failure | ternary ('success, failure', 'success' ) }}"
  when:
      - wn10_AU_000150
  tags:
      - WN10-AU-000150
      - CAT2
      - CCI-002234
      - CCI-000172
      - SRG-OS-000327-GPOS-00127
      - SV-220776r569187_rule
      - V-220776

- name: |
    "MEDIUM | WN10-AU-000155 | PATCH | The system must be configured to audit System - System Integrity failures."
    "MEDIUM | WN10-AU-000160 | PATCH | The system must be configured to audit System - System Integrity successes."
  win_audit_policy_system:
      subcategory: System Integrity
      audit_type: "{{ (wn10_AU_000155 and not wn10_AU_000160) | ternary ('failure', '') }}{{ (wn10_AU_000160 and not wn10_AU_000155) | ternary ('success', '') }}{{ (wn10_AU_000155 and wn10_AU_000160) | ternary ('success, failure', '') }}"
  when:
      - wn10_AU_000155 or
        wn10_AU_000160
  tags:
      - WN10-AU-000155
      - WN10-AU-000160
      - CAT2
      - CCI-002234
      - CCI-000172
      - SRG-OS-000327-GPOS-00127
      - SV-220777r569187_rule
      - SV-220778r569187_rule
      - V-220777
      - V-220778